# 市场邮件控制

## 一、需求背景

> 随着项目的逐渐壮大，市场邮件消息越来越多，有时不太重要的通知邮件对管理人员造成了一定的困扰，因此细粒度到每个消息模板的邮件控制系统由此而生。

## 二、基本原理

### 1、原理

​        自定义的一个消息客户端`HmktMessageClient`包装hzero的MessageClient，重写基本消息发送方法并在其中添加了自定义的控制逻辑

### 2、控制流程

![image-20210818103125774](C:\Users\liudong\AppData\Roaming\Typora\typora-user-images\image-20210818103125774.png)

### 三、基本使用

+ 控制开关：MessageProperties.emailMessageControl属性配置，默认为false，可通过配置文件application.yml开启，如下图所示![image-20210818105009366](C:\Users\liudong\AppData\Roaming\Typora\typora-user-images\image-20210818105009366.png)

+ 控制值集：HMKT.MESSAGE_CONTROL_EMAIL，在值集中添加相关邮件的模板编码标识使用该模板的邮件在邮件消息控制开启的状况下能正常发送。


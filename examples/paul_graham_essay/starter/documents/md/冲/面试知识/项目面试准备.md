项目登录流程：

![image-20200707173200893](C:\Users\liudong\Documents\mdDocument\面试知识\项目面试准备.assets\image-20200707173200893.png)

登录拦截：

```Java
@Service
public class SessionInterceptor implements HandlerInterceptor {
    @Autowired
    UserMapper userMapper;
    @Autowired
    NotificationService notificationService;
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        Cookie[] cookies = request.getCookies();
```

分页：

```
List<Question> questionList = questionMapper.selectByExampleWithRowbounds(questionExample1, new RowBounds(offset, size));
```

```
得到页面参数：
private List<T> data;
private boolean showPrevious;
private boolean showFirstPage;
private boolean showNext;
private boolean showEndPage;
private Integer page;//当前页码
private List<Integer> pages=new ArrayList<>();//包含页码
private Integer totalPage;
```

异常处理：

自定义异常

![image-20200707181829209](C:\Users\liudong\Documents\mdDocument\面试知识\项目面试准备.assets\image-20200707181829209.png)

top n：

```
//遍历问题，计算标签权重，放入HashMap
while (offset == 0 || list.size() == limit) {
    list = questionMapper.selectByExampleWithRowbounds(new QuestionExample(), new RowBounds(offset, limit));
    for (Question question : list) {

        String[] tagsInQuestion = StringUtils.split(question.getTag(), ",");
        for (String aTag : tagsInQuestion) {
            Integer priority = hotTags.get(aTag);
            if (priority != null) {
                hotTags.put(aTag, priority + 5 + question.getCommentCount());
            } else {
                hotTags.put(aTag, 5 + question.getCommentCount());
            }
        }
    }
    offset += limit;
}
hotTagCache.updateTags(hotTags);
```

```
//使用优先队列遍历标签权重获取top 3标签（模拟大顶堆）
int max=8;
PriorityQueue<HotTagDTO> priorityQueue=new PriorityQueue<>(max);

tags.forEach((name,priority)->{
    HotTagDTO hotTagDTO = new HotTagDTO();
    hotTagDTO.setName(name);
    hotTagDTO.setPriority(priority);
    if (priorityQueue.size()<max){
        priorityQueue.add(hotTagDTO);
    }else {
        HotTagDTO minHot = priorityQueue.peek();
        if (hotTagDTO.compareTo(minHot)>0){
            priorityQueue.poll();
            priorityQueue.add(hotTagDTO);
        }
    }
});

//新热门标签放入hots并从大到小排序
HotTagDTO poll = priorityQueue.poll();
while (poll!=null){
    hots.add(0,poll.getName());//将后出队列的标签（最热）放在第一个
    poll=priorityQueue.poll();

}
```

事务:

回复 1、评论/问题 2、增加评论数 3、添加通知
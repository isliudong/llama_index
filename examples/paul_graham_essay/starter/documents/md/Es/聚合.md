# [elasticsearch中多个字段聚合两种方法介绍](https://www.cnblogs.com/libin2015/p/11661703.html)

#### 两种方式

1、大桶套小桶，通过terms一层层聚合
这个方法适用于需要统计每一项的数据，比如a中有多少种b

2、函数扩展（script）聚合
这个方法适用于直接统计有多少种组合

```
GET ****_20190926/_search
{
  "size": 0,
  "aggs": {
    "pre": {
      "terms": {
        "script": "doc['inChannel'].values +'####'+doc['resCode'].values",
        "size": 5
      }
    }
  }
}
```

```java
Script script = new Script("doc['inChannel'].values +'####'+ doc['resCode'].values");

//用于统计每一项详细数据
TermsAggregationBuilder app = AggregationBuilders.terms("app").script(script).size(10000);

//用于统计有多少项
CardinalityAggregationBuilder app = AggregationBuilders.cardinality("app").script(script).precisionThreshold(10000);
```

